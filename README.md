# CaptchAutofill

[![Nightly Build](https://github.com/pengchengz30/CaptchAutofill-Xposed/actions/workflows/release.yml/badge.svg?branch=main)](https://github.com/pengchengz30/CaptchAutofill-Xposed/actions/workflows/release.yml)
[![Latest Release](https://img.shields.io/github/v/release/pengchengz30/CaptchAutofill-Xposed?color=green&label=Release)](https://github.com/pengchengz30/CaptchAutofill-Xposed/releases)
![Platform](https://img.shields.io/badge/Platform-Android%2016%20(Baklava)-orange)
![API Level](https://img.shields.io/badge/API-36-blue)
![License](https://img.shields.io/github/license/pengchengz30/CaptchAutofill-Xposed?style=flat&color=3498db)

**CaptchaAutofill** is a high-performance LSPosed module designed to intercept system notifications and automatically extract verification codes. Specifically optimized for **Android 16 (Baklava)** and **Pixel 10 Pro** hardware, it focuses on architectural decoupling and reliability.

---

## üåü Key Features

* **App Whitelisting:** Granular control over which applications are monitored for verification codes.
* **Zero-Ignition Sync:** Optimized boot synchronization logic using explicit system broadcasts to bypass the Android "Stopped State".
* **Architectural Decoupling:** Configuration is managed via a dedicated App UI, while the `system_server` hook remains lightweight and stateless.
* **Modern Build Chain:** Fully automated CI/CD pipeline using native Gradle signing and API 36 build tools.

---

## üõ† Installation

1.  **Download:** Get the latest `Release.apk` from the [Releases](https://github.com/pengchengz30/CaptchAutofill-Xposed/releases) page.
2.  **LSPosed Setup:**
    * Install the APK and enable the module in the LSPosed Manager.
    * **Scope:** Select **ONLY** the `System Framework` (package: `android`). 
    * *Note:* Since all notifications are generated by the system, hooking other apps is unnecessary and inefficient.
3.  **Configuration:** Open the CaptchaAutofill app and select the messaging or social apps you wish to whitelist.
4.  **Reboot:** A reboot is recommended to initialize the "Zero-Ignition" sync logic.

---

## üèó Technical Architecture

### Boot Synchronization Logic
To ensure the module works immediately after a cold boot without requiring the user to manually open the app, CaptchaAutofill implements a specialized `REQUEST_SYNC` broadcast:
* **Explicit Intent:** Targets the `BootReceiver` directly to bypass implicit broadcast restrictions.
* **Flag 0x20:** Utilizes `FLAG_INCLUDE_STOPPED_PACKAGES` to wake the app process even if it has been force-stopped by the system.

### CI/CD & Security
The project utilizes a native Gradle signing workflow within GitHub Actions:
* **Keystore Security:** The signing key is stored as a Base64-encoded GitHub Secret and decoded at runtime into the RAM.
* **ProGuard/R8:** The release build is fully obfuscated, while sensitive logging is stripped using `-assumenosideeffects` rules to ensure privacy.

---

## üíª Development

### Prerequisites
* Android Studio Ladybug or newer.
* JDK 17.
* Android SDK 36 (Baklava).

### üèó Local Build & Signing

The build system features a **"Self-Healing" signing logic**. It supports two distinct methods for signing the Release APK, prioritizing local developer convenience while maintaining high-security standards for CI/CD environments.

#### 1. Configure Environment Variables
To generate a signed release, you must provide either a local keystore path **OR** a Base64-encoded string via environment variables.

| Variable | Description | Priority |
| :--- | :--- | :--- |
| **`KEYSTORE`** | **Absolute path** to your `.jks` file on disk. | **1 (High)** |
| **`KEYSTORE_BASE64`** | Base64 string of your keystore (used if `KEYSTORE` is empty). | **2 (Low)** |
| `KEYSTORE_PASSWORD` | Password for the keystore. | Required |
| `KEY_ALIAS` | Alias for the signing key. | Required |
| `KEY_PASSWORD` | Password for the specific key alias. | Required |

---

#### 2. Choose Your Signing Method

**Option A: Local Path (Recommended for daily development)**

Use this if you have the physical keystore file available on your local machine.
```bash
# Set the path to your local .jks file
export KEYSTORE="/path/to/your/release.jks"
export KEYSTORE_PASSWORD="your_password"
export KEY_ALIAS="your_alias"
export KEY_PASSWORD="your_key_password"

./gradlew clean assembleRelease
```

**Option B: In-Memory / Base64 (Recommended for CI & Security)**

Use this to sign the APK in RAM (/dev/shm) without leaving any persistent traces on your physical disk. This is the method used by our GitHub Actions pipeline.
```bash
# Ensure KEYSTORE is unset to trigger the Base64 logic
unset KEYSTORE 
export KEYSTORE_BASE64="your_long_base64_string_here..."
export KEYSTORE_PASSWORD="your_password"
export KEY_ALIAS="your_alias"
export KEY_PASSWORD="your_key_password"

./gradlew clean assembleRelease
```


## üìÇ Project Structure

Since this project follows the **Modern Android Build Convention**, some critical configuration files are located in the root directory (switch to **"Project" view** in Android Studio to see them):

* `build.gradle.kts` (Project): Root-level build configuration.
* `app/build.gradle.kts`: Module-specific logic, including the **RAM-based signing logic**.
* `libs.versions.toml`: Centralized dependency management (Version Catalog).
* `.env.example`: Template for local environment variables (Keystore/Passwords).

---

## üîç Debugging & Logs

To monitor the extraction process or troubleshoot "Zero-Ignition" sync issues on your **Pixel 10 Pro**:

1.  **LSPosed Logs:** Check the "Log" section in the LSPosed Manager for `XposedBridge` outputs.
2.  **Logcat:** Filter tags related to the module's package:
    ```bash
    # -v color enables color-coded output (Debug: Blue/Green, Error: Red, etc.)
    # -s filters for the AUTOFILL_DEBUG tag at Debug level and above
    adb logcat -v color -s "AUTOFILL_DEBUG:D"
    ```
    * **Note:** In Release builds, sensitive logs are stripped by R8/ProGuard for privacy and performance.*
3.  **RAM Check:** To verify if the keystore was correctly restored to memory during a local build:
    ```bash
    ls -l /dev/shm/release.jks
    ```

---

## ‚ö†Ô∏è Disclaimer

* **Root Required:** This module requires a rooted device with **LSPosed** (or compatible) framework installed.
* **Privacy:** While this module is designed for local extraction, always ensure you trust the modules you install. CaptchaAutofill is open-source for full transparency.
* **Warranty:** I am not responsible for bricked devices, dead SD cards, or thermonuclear war. Use at your own risk.

---

## üìú License

Distributed under the **GPL-3.0 License**. See [LICENSE](./LICENSE) for more information.

---

## üë®‚Äçüíª About the Author

**Pengcheng Zhang**
* **Education:** Master of Engineering in Electrical and Computer Engineering at **Cornell University**.
* **Location:** Based in **Ithaca, NY**.
* **Focus:** Back-end development, Android System Customization, AI-driven Software Engineering, and High-Performance Architectures.